<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GPT Tutor Score Submission</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      color: #333;
    }
    .message {
      font-size: 1.2rem;
      padding: 1rem;
      border-radius: 8px;
      max-width: 600px;
      margin-top: 2rem;
    }
    .success {
      background-color: #e0ffe0;
      border: 1px solid #7abf7a;
    }
    .error {
      background-color: #ffe0e0;
      border: 1px solid #bf7a7a;
    }
  </style>
</head>
<body>
  <h1>Recording Your Score...</h1>
  <div id="result" class="message">⏳ Please wait while we record your score...</div>

  <script>
    const resultBox = document.getElementById('result');

    function parseQueryParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        id: params.get('id'),
        course: params.get('course'),
        lesson: params.get('lesson'),
        score: params.get('score')
      };
    }

    async function submitScore() {
      const data = parseQueryParams();

      if (!data.id || !data.lesson || !data.score) {
        resultBox.textContent = '❌ Missing student ID, lesson, or score.';
        resultBox.className = 'message error';
        return;
      }

      try {
        const response = await fetch('https://script.google.com/a/macros/colorado.edu/s/AKfycbwAc5KdJ-iAUjmzIPoVX7MLZGU4xVyJpGQZ3vLUsvn87O7GVC_J_vcYv7Y-y8uCsGGQ/exec', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const text = await response.text();
        if (text.includes('✅')) {
          resultBox.textContent = text;
          resultBox.className = 'message success';
        } else {
          resultBox.textContent = '❌ There was a problem: ' + text;
          resultBox.className = 'message error';
        }
      } catch (error) {
        resultBox.textContent = '❌ Network error: ' + error.message;
        resultBox.className = 'message error';
      }
    }

    submitScore();
  </script>
</body>
</html>
